<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Planet Clicker</title>
  <style>
    /* ===============================
       Global and Layout Styles
    =============================== */
    *, *::before, *::after {
      box-sizing: border-box;
    }
    html {
      font-size: 2.5vmin;
    }
    body {
      margin: 0;
      min-height: 100vh;
      background: #000;
      overflow: hidden;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      color: #e0d56f;
    }
    .dollars-counter {
      width: 100vw;
      text-align: center;
      position: fixed;
      top: 1rem;
      left: 0;
      color: #e0d56f;
      font-size: 2.5rem;
      letter-spacing: 0.1rem;
      z-index: 10;
      font-weight: bold;
      user-select: none;
      padding: 0.8rem 0 0.5rem 0;
      flex-shrink: 0;
    }
    .dollars-per-second {
      width: 100vw;
      text-align: center;
      position: fixed;
      top: 4rem;
      left: 0;
      color: #a3e7ff;
      font-size: 1.2rem;
      letter-spacing: 0.05rem;
      z-index: 10;
      font-weight: 600;
      user-select: none;
      padding-bottom: 0.5rem;
    }
    #topButtonsContainer {
      position: fixed;
      top: 1rem;
      left: 1rem;
      display: flex;
      gap: 0.4rem;
      z-index: 30;
      user-select: none;
    }
    #topButtonsContainer a#homeBtn,
    #topButtonsContainer button#settingsBtn {
      background-color: #1877ff;
      color: white;
      border: none;
      outline: none;
      border-radius: 0 .4rem .4rem 0;
      font-weight: 700;
      font-size: 1.2rem;
      padding: 0.4rem 0.8rem;
      cursor: pointer;
      transition: background-color 0.3s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
    }
    #topButtonsContainer a#homeBtn {
      border-radius: .4rem 0 0 .4rem;
    }
    #topButtonsContainer a#homeBtn:hover,
    #topButtonsContainer button#settingsBtn:hover {
      background-color: #3ea0ff;
    }
    .main-content {
      display: flex;
      flex-grow: 1;
      height: calc(100vh - 5rem);
      overflow: hidden;
      margin: 5rem 4.5rem 0 4.5rem;
      position: relative;
      transition: margin 0.5s ease, padding 0.5s ease, width 0.5s ease;
    }
    .main-content.centered-earth {
      margin-left: auto;
      margin-right: auto;
      width: fit-content;
      padding-left: 3rem;
      padding-right: 3rem;
      overflow-x: visible;
    }
    .earth-section {
      flex: 2;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      z-index: 2;
      min-width: 0;
      min-height: 0;
      transition: flex 0.3s ease;
    }
    .main-content.centered-earth .earth-section {
      flex: none;
      width: 12rem;
      margin: 0 20px;
      min-width: 0;
    }
    .shop-section {
      flex: 1;
      background: #111a2a;
      color: #62a7f7;
      box-shadow: inset 0 0 3rem #0a2e6c;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 1rem 1rem;
      font-size: 1.2rem;
      font-weight: 700;
      user-select: none;
      position: relative;
      z-index: 1;
      overflow-y: auto;
      border-radius: 0.4rem;
      max-height: 100%;
      transition: width 0.5s ease, opacity 0.5s ease;
    }
    .shop-closed {
      width: 0;
      opacity: 0;
      pointer-events: none;
      padding: 0;
      border: none;
      box-shadow: none;
    }
    .shop-label {
      width: 100%;
      text-align: center;
      font-size: 1.6rem;
      font-weight: 700;
      color: #62a7f7;
      padding-bottom: 1rem;
      user-select: none;
      border-bottom: 1px solid #275aa8;
      margin-bottom: 1rem;
    }
    .shop-item {
      width: 100%;
      background: #0c1f3f;
      border: 1px solid #275aa8;
      margin-bottom: 0.7rem;
      padding: 0.6rem 0.8rem;
      border-radius: 0.4rem;
      display: flex;
      flex-direction: column;
      user-select: none;
    }
    .shop-item-name {
      color: #87ccff;
      font-weight: 700;
      font-size: 1.15rem;
    }
    .shop-item-desc {
      color: #aad8ff;
      font-weight: 400;
      font-size: 0.95rem;
      margin: 0.2rem 0 0.6rem 0;
    }
    .shop-item-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .shop-price {
      color: #62a7f7;
      font-weight: 600;
    }
    button.buy-button {
      background: #1877ff;
      color: white;
      border: none;
      outline: none;
      border-radius: 0.3rem;
      cursor: pointer;
      user-select: none;
      padding: 0.35rem 0.8rem;
      font-weight: 700;
      font-size: 1rem;
      transition: background-color 0.2s ease;
    }
    button.buy-button:disabled {
      background-color: #3b4a6d;
      cursor: not-allowed;
    }
    button.buy-button:hover:not(:disabled) {
      background-color: #3ea0ff;
    }
    #clickButton {
      background: none;
      border: none;
      outline: none;
      padding: 0;
      cursor: pointer;
      width: 12rem;
      aspect-ratio: 1 / 1;
      position: relative;
      z-index: 1;
      min-width: 0;
      min-height: 0;
      display: block;
      margin: 0 auto;
    }
    #earthSVG, #marsSVG {
      width: 100%;
      height: 100%;
      display: block;
      user-select: none;
      filter: drop-shadow(0 0 1rem);
      animation: spinEarth 8s linear infinite;
      transition: filter 0.3s;
      z-index: 2;
    }
    #earthSVG {
      filter: drop-shadow(0 0 1rem #4bd5fa);
    }
    #marsSVG {
      filter: drop-shadow(0 0 1rem #f44a44);
      fill: #d33;
    }
    #clickButton:active #earthSVG {
      filter: drop-shadow(0 0 2rem #30ffa6);
    }
    #clickButton:active #marsSVG {
      filter: drop-shadow(0 0 2rem #ff9a70);
    }
    .earth-label, .mars-label {
      margin-top: 1.5rem;
      font-size: 2rem;
      letter-spacing: 0.1rem;
      font-weight: 700;
      user-select: none;
      text-align: center;
    }
    .earth-label {
      color: #6ad0f5;
      text-shadow: 0 0 0.5rem #167ac6;
    }
    .mars-label {
      color: #f44a44;
      text-shadow: 0 0 0.5rem #a33122;
    }
    .arrow-container {
      position: fixed;
      top: 50%;
      width: 2.5rem;
      height: 2.5rem;
      background: #0b3c89;
      box-shadow: 0 0 0.4rem #295baf;
      border-radius: 0.4rem;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      user-select: none;
      z-index: 20;
      transform: translateY(-50%);
      opacity: 1;
      transition: opacity 0.4s ease;
      pointer-events: auto;
    }
    .arrow-container.hidden {
      opacity: 0;
      pointer-events: none;
    }
    #leftArrowContainer {
      left: 1rem;
    }
    #rightArrowContainer {
      right: 1rem;
    }
    .nav-arrow {
      width: 1.4rem;
      height: 1.4rem;
      filter: drop-shadow(0 0 0.1rem #0a1a2b);
    }
    .nav-arrow svg {
      fill: #62a7f7;
      width: 100%;
      height: 100%;
    }
    canvas.stars {
      position: fixed;
      width: 100vw;
      height: 100vh;
      top: 0;
      left: 0;
      z-index: 0;
    }
    .float-plus {
      position: absolute;
      left: 50%;
      top: 6%;
      font-size: 1.6rem;
      font-weight: bold;
      color: #87ffd7;
      text-shadow: 0 0 0.3rem #24e9ce, 0 0 0.8rem #1abc9c;
      pointer-events: none;
      z-index: 10;
      opacity: 0.7;
      animation: plusFlySmooth 1.3s cubic-bezier(.37,.3,.5,1) forwards;
      transform: translateX(-50%);
    }

    #shopToggleBtn {
      position: fixed;
      top: 1rem;
      right: 1rem;
      background-color: #1877ff;
      color: white;
      border: none;
      outline: none;
      border-radius: 0.4rem 0 .4rem 0;
      font-weight: 700;
      font-size: 1.2rem;
      padding: 0.4rem 0.8rem;
      cursor: pointer;
      user-select: none;
      z-index: 30;
      transition: background-color 0.3s ease;
    }
    #shopToggleBtn:hover {
      background-color: #3ea0ff;
    }
    #settingsDropdown {
      position: fixed;
      top: 3.5rem;
      left: 6rem;
      background-color: #111a2a;
      box-shadow: 0 0 1rem #0a2e6c;
      border-radius: 0.4rem;
      padding: 0.5rem 1rem;
      font-size: 1.1rem;
      font-weight: 600;
      color: #62a7f7;
      display: none;
      user-select: none;
      z-index: 30;
    }
    #settingsDropdown button {
      background: #1877ff;
      border: none;
      color: white;
      font-weight: 700;
      border-radius: 0.3rem;
      cursor: pointer;
      padding: 0.25rem 0.6rem;
      margin: 0.2rem 0;
      width: 100%;
      text-align: center;
      transition: background-color 0.2s ease;
    }
    #settingsDropdown button:hover {
      background-color: #3ea0ff;
    }
    .shop-section::-webkit-scrollbar {
      width: 12px;
    }
    .shop-section::-webkit-scrollbar-track {
      background: #0a2e6c;
      border-radius: 6px;
    }
    .shop-section::-webkit-scrollbar-thumb {
      background-color: #1877ff;
      border-radius: 6px;
      border: 3px solid #0a2e6c;
      transition: background-color 0.3s ease;
    }
    .shop-section::-webkit-scrollbar-thumb:hover {
      background-color: #3ea0ff;
    }
    .shop-section {
      scrollbar-width: thin;
      scrollbar-color: #1877ff #0a2e6c;
    }
    @keyframes spinEarth {
      0% {
        transform: rotate(0deg);
      }
      100% {
        transform: rotate(360deg);
      }
    }
    @keyframes plusFlySmooth {
      0% {
        opacity: 0.7;
        transform: translateX(-50%) translateY(0) scale(1.0);
        filter: blur(0);
      }
      70% {
        opacity: 1;
        transform: translateX(-50%) translateY(-2rem) scale(1.08);
        filter: blur(0);
      }
      100% {
        opacity: 0;
        transform: translateX(-50%) translateY(-3.2rem) scale(0.95);
        filter: blur(0.25rem);
      }
    }
  </style>
</head>
<body>
<div id="topButtonsContainer">
  <a href="../Index/index.html" id="homeBtn" aria-label="Home">Home</a>
  <button id="settingsBtn" aria-haspopup="true" aria-expanded="false" aria-controls="settingsDropdown" aria-label="Settings">Settings</button>
</div>
<div class="dollars-counter" id="counter">Dollars: 0</div>
<div class="dollars-per-second" id="dpsCounter">Dollars per second: 0</div>
<div id="settingsDropdown" role="menu" aria-label="Settings Menu">
  <button id="resetGameBtn" role="menuitem">Reset Game</button>
</div>
<button id="shopToggleBtn" aria-expanded="false" aria-controls="shopSection" aria-label="Toggle Shop">Shop</button>
<canvas class="stars"></canvas>
<div id="leftArrowContainer" class="arrow-container" tabindex="0" aria-label="Previous Planet" role="button">
  <svg viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
</div>
<div id="rightArrowContainer" class="arrow-container" tabindex="0" aria-label="Next Planet" role="button">
  <svg viewBox="0 0 24 24"><path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6z"/></svg>
</div>
<div class="main-content centered-earth" id="mainContent">
  <div class="earth-section">
    <button id="clickButton" tabindex="0" aria-hidden="true" style="z-index:1;">
      <svg id="earthSVG" viewBox="0 0 140 140" xmlns="http://www.w3.org/2000/svg" role="img" style="display:block;">
        <circle cx="70" cy="70" r="68" fill="#2e85ff" stroke="#1a4c8b" stroke-width="2"/>
        <ellipse cx="56" cy="83" rx="26" ry="14" fill="#56c271" opacity="0.98"/>
        <ellipse cx="93" cy="59" rx="19" ry="10" fill="#70be75" opacity="0.87"/>
        <ellipse cx="74" cy="48" rx="11" ry="6.5" fill="#6dc567" opacity="0.92"/>
        <ellipse cx="100" cy="110" rx="13" ry="6" fill="#63aa6c" opacity="0.80"/>
        <ellipse cx="70" cy="18" rx="19" ry="7" fill="#f5f5fa" opacity="0.62"/>
        <ellipse cx="70" cy="123" rx="17" ry="6" fill="#f5f5fa" opacity="0.64"/>
        <ellipse cx="40" cy="45" rx="15" ry="6" fill="#bbeeff" opacity="0.45"/>
      </svg>
      <svg id="marsSVG" viewBox="0 0 140 140" xmlns="http://www.w3.org/2000/svg" role="img" style="display:none;">
        <circle cx="70" cy="70" r="68" fill="#d33" stroke="#701" stroke-width="2"/>
        <circle cx="50" cy="65" r="14" fill="#a42e2e" opacity="0.8"/>
        <ellipse cx="80" cy="90" rx="10" ry="5" fill="#922" opacity="0.7"/>
        <circle cx="100" cy="60" r="8" fill="#a13939" opacity="0.6"/>
        <ellipse cx="40" cy="110" rx="11" ry="6" fill="#992929" opacity="0.75"/>
      </svg>
    </button>
    <div id="plusContainer" style="position:absolute;top:0;left:0;width:100%;pointer-events:none;z-index:10;"></div>
    <div id="planetLabelsContainer" style="text-align:center;">
      <div id="earthLabel" class="earth-label" style="display:block;">Earth</div>
      <div id="marsLabel" class="mars-label" style="display:none;">Mars</div>
    </div>
  </div>
  <div class="shop-section shop-closed" tabindex="-1" id="shopSection" aria-hidden="true">
    <div class="shop-label">Shop</div>
  </div>
</div>
<script>
  // Starfield animation setup
  const canvas = document.querySelector('.stars');
  const ctx = canvas.getContext('2d');
  let stars = [];
  const STAR_COUNT = 180;
  function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  window.addEventListener('resize', resizeCanvas);
  function initStars() {
    stars = [];
    for(let i=0; i<STAR_COUNT; i++){
      stars.push({
        x: Math.random()*canvas.width,
        y: Math.random()*canvas.height,
        r: Math.random()*1.2+0.1,
        speed: 0.12+Math.random()*0.2,
      });
    }
  }
  function drawStars(){
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    for(const star of stars){
      ctx.beginPath();
      ctx.arc(star.x, star.y, star.r, 0, Math.PI*2);
      ctx.fillStyle = 'rgba(255,255,255,0.8)';
      ctx.fill();
    }
  }
  function updateStars(){
    for(const star of stars){
      star.x += star.speed;
      if(star.x > canvas.width + 2){
        star.x = -2;
        star.y = Math.random() * canvas.height;
      }
    }
  }
  function animateStars(){
    updateStars();
    drawStars();
    requestAnimationFrame(animateStars);
  }
  function startStars(){
    resizeCanvas();
    initStars();
    animateStars();
  }
  startStars();

  // Game state & references
  let dollars = 0;
  let dps = 0;
  let clickBonus = 0;
  let currentPlanet = 0;
  let savedGame = null;
  const counterEl = document.getElementById('counter');
  const dpsEl = document.getElementById('dpsCounter');
  const clickBtn = document.getElementById('clickButton');
  const plusContainer = document.getElementById('plusContainer');
  const shopEl = document.getElementById('shopSection');
  const shopToggleBtn = document.getElementById('shopToggleBtn');
  const mainContent = document.getElementById('mainContent');
  const leftArrowContainer = document.getElementById('leftArrowContainer');
  const rightArrowContainer = document.getElementById('rightArrowContainer');
  const earthLabel = document.getElementById('earthLabel');
  const marsLabel = document.getElementById('marsLabel');
  const settingsBtn = document.getElementById('settingsBtn');
  const settingsDropdown = document.getElementById('settingsDropdown');
  const resetGameBtn = document.getElementById('resetGameBtn');
  const homeBtn = document.getElementById('homeBtn');

  // Planets & Shops
  const planets = [
    {
      name: "Earth",
      shop: [
        { name: 'Lazy Cash Machine', basePrice: 50, dps: 1, count: 0, desc: "+1 dollar per second" },
        { name: 'Efficient Printer', basePrice: 300, dps: 3, count: 0, desc: "+3 dollars per second" },
        { name: 'Squirrel Consultant', basePrice: 700, dps: 5, count: 0, desc: "+5 dollars per second" },
        { name: 'Drone Delivery System', basePrice: 1500, dps: 10, count: 0, desc: "+10 dollars per second" },
        { name: 'Coffee Infusion', basePrice: 1500, clickAdd: 1.5, count: 0, desc: "Click value +1.5 dollars per click" },
        { name: 'Giant Hamster Wheel', basePrice: 3000, dps: 10, count: 0, desc: "+10 dollars per second" },
        { name: "CEO's Signature Pen", basePrice: 3000, dps: 20, count: 0, desc: "+20 dollars per second" },
        { name: "Space Elevator", basePrice: 5000, dps: 50, count: 0, desc: "+50 dollars per second" },
        { name: "Internet Meme Rights", basePrice: 6000, dps: 70, count: 0, desc: "+70 dollars per second" },
        { name: 'Fortune Cookie', basePrice: 8000, dps: 100, count: 0, desc: "+100 dollars per second" },
        { name: 'Viral Dance Craze', basePrice: 8500, clickAdd: 1.8, count: 0, desc: "Click value +1.8 dollars per click" },
        { name: 'Meme Generator', basePrice: 10000, clickAdd: 3, count: 0, desc: "Click value +3 dollars per click" },
        { name: 'Click Booster 3000', basePrice: 12000, clickAdd: 4, count: 0, desc: "Click value +4 dollars per click" },
        { name: 'Marketing Blitz', basePrice: 18000, dps: 150, count: 0, desc: "+150 dollars per second" },
        { name: 'AI Accountant', basePrice: 25000, dps: 200, count: 0, desc: "+200 dollars per second" },
        { name: 'Robotic Cashiers', basePrice: 50000, dps: 500, count: 0, desc: "+500 dollars per second" },
        { name: 'Finish Civics Bookwork', basePrice: 60000, dps: 700, count: 0, desc: "+700 dollars per second" },
        { name: 'Private Jet', basePrice: 100000, clickAdd: 5, count: 0, desc: "Click value +5 dollars per click" },
        { name: 'Golden ATM', basePrice: 150000, dps: 1000, count: 0, desc: "+1,000 dollars per second" },
        { name: 'Luxury Watch', basePrice: 200000, clickAdd: 7, count: 0, desc: "Click value +7 dollars per click" },
        { name: 'CEO Shark Tank', basePrice: 500000, clickAdd: 10, count: 0, desc: "Click value +10 dollars per click" },
        { name: 'Slaves', basePrice: 800000, clickAdd: 15, count: 0, desc: "Click value +15 dollars per click" },
        { name: 'Cocaine Dealership', basePrice: 1000000, dps: 10000, count: 0, desc: "+10,000 dollars per second" },
      ],
    },
    {
      name: "Mars",
      shop: [
        { name: 'Mars Drill', basePrice: 150, dps: 5, count: 0, desc: "+5 dollars per second" },
        { name: 'Martian Rover', basePrice: 600, dps: 15, count: 0, desc: "+15 dollars per second" },
        { name: 'Alien Consultant', basePrice: 1200, clickAdd: 2, count: 0, desc: "Click value +2 dollars" },
        { name: 'Red Planet Mining', basePrice: 9000, dps: 45, count: 0, desc: "+45 dollars per second" },
        { name: 'Martian Luxury', basePrice: 13000, clickAdd: 3, count: 0, desc: "Click value +3 dollars" },
        { name: 'Warrior Robots', basePrice: 25000, dps: 300, count: 0, desc: "+300 dollars per second" },
        { name: 'Space Pirates', basePrice: 53000, dps: 900, count: 0, desc: "+900 dollars per second" },
        { name: 'Alien Artifacts', basePrice: 102000, clickAdd: 7, count: 0, desc: "Click value +7 dollars" },
        { name: 'Asteroid Miners', basePrice: 220000, dps: 4500, count: 0, desc: "+4,500 dollars per second" },
        { name: 'Teleport Station', basePrice: 670000, clickAdd: 15, count: 0, desc: "Click value +15 dollars" },
        { name: 'Galactic Market', basePrice: 1100000, dps: 9988, count: 0, desc: "+9,988 dollars per second" },
        { name: 'Cosmic Builder', basePrice: 2700000, clickAdd: 25, count: 0, desc: "Click value +25 dollars" },
        { name: 'Space Port', basePrice: 6500000, dps: 31000, count: 0, desc: "+31,000 dollars per second" },
        { name: 'Galactic Lottery', basePrice: 7000000, clickAdd: 50, count: 0, desc: "Click value +50 dollars" },
      ],
    }
  ];
  let shopItems = planets[0].shop;

  function getPrice(item){
    return Math.floor(item.basePrice * Math.pow(1.2, item.count));
  }

  function renderShop(){
    shopEl.innerHTML = '<div class="shop-label">Shop</div>';
    shopItems.forEach((item, idx) => {
      const div = document.createElement('div');
      div.className = 'shop-item';
      const name = document.createElement('div');
      name.className = 'shop-item-name';
      name.textContent = item.name;

      const desc = document.createElement('div');
      desc.className = 'shop-item-desc';
      desc.textContent = item.desc;

      const footer = document.createElement('div');
      footer.className = 'shop-item-footer';

      const count = document.createElement('div');
      count.style.color = '#aad8ff';
      count.style.fontWeight = '600';
      count.style.marginRight = '1rem';
      count.textContent = `Bought: ${item.count}/30`;

      const price = document.createElement('div');
      price.className = 'shop-price';
      price.textContent = `Price: $${getPrice(item)}`;

      const buyBtn = document.createElement('button');
      buyBtn.className = 'buy-button';
      buyBtn.textContent = 'Buy';
      buyBtn.disabled = dollars < getPrice(item) || item.count >= 30;
      buyBtn.addEventListener('click', () => buyItem(idx));

      footer.append(count, price, buyBtn);
      div.append(name, desc, footer);
      shopEl.appendChild(div);
    });
  }

  function buyItem(idx){
    let item = shopItems[idx];
    if(item.count >= 30 || dollars < getPrice(item)) return;
    dollars -= getPrice(item);
    item.count++;
    if(item.dps) dps += item.dps;
    if(item.clickAdd) clickBonus += item.clickAdd;
    updateDisplay();
    renderShop();
    saveGame();
  }

  function updateDisplay(){
    counterEl.textContent = `Dollars: ${Math.floor(dollars)}`;
    dpsEl.textContent = `Dollars per second: ${Math.floor(dps)}`;
  }

  function showPlus(amount){
    const plus = document.createElement('div');
    plus.className = "float-plus";
    plus.textContent = `+${amount}`;
    plusContainer.appendChild(plus);
    plus.addEventListener('animationend', () => plus.remove());
  }

  clickBtn.addEventListener('click', () => {
    let gain = 1 + clickBonus;
    dollars += gain;
    updateDisplay();
    showPlus(gain);
    saveGame();
  });

  // Save/load enhanced to store data per planet and transfer upon switching
  function saveGame(){
    if(!savedGame) savedGame = {planetStates: []};
    savedGame.planetStates[currentPlanet] = {
      shopData: JSON.parse(JSON.stringify(planets[currentPlanet].shop)),
      dollars: dollars,
      dps: dps,
      clickBonus: clickBonus
    };
    savedGame.currentPlanet = currentPlanet;
    localStorage.setItem("planet_clicker_save", JSON.stringify(savedGame));
  }

  function loadGame(){
    let saveText = localStorage.getItem("planet_clicker_save");
    if(!saveText) return;
    try{
      savedGame = JSON.parse(saveText);
      currentPlanet = savedGame.currentPlanet || 0;
      if(savedGame.planetStates){
        savedGame.planetStates.forEach((state, idx) => {
          if(state && planets[idx]){
            planets[idx].shop = state.shopData || planets[idx].shop;
          }
        });
      }
    }catch(e){
      console.warn("Failed to load save", e);
    }
  }

  /*
   * Update planet view and restore money & stats for currentPlanet
   */
  function updatePlanetView(){
    const earthSVG = document.getElementById('earthSVG');
    const marsSVG = document.getElementById('marsSVG');
    if(currentPlanet === 0){
      earthSVG.style.display = 'block';
      marsSVG.style.display = 'none';
      earthLabel.style.display = 'block';
      marsLabel.style.display = 'none';
    }
    else{
      earthSVG.style.display = 'none';
      marsSVG.style.display = 'block';
      earthLabel.style.display = 'none';
      marsLabel.style.display = 'block';
    }
    shopItems = planets[currentPlanet].shop;
    // Restore saved state if exists, else reset to zero
    if(savedGame && savedGame.planetStates && savedGame.planetStates[currentPlanet]){
      let state = savedGame.planetStates[currentPlanet];
      dollars = state.dollars || 0;
      dps = state.dps || 0;
      clickBonus = state.clickBonus || 0;
      planets[currentPlanet].shop = state.shopData || planets[currentPlanet].shop;
      shopItems = planets[currentPlanet].shop;
    } else {
      dollars = 0;
      dps = 0;
      clickBonus = 0;
    }
    updateDisplay();
    renderShop();
    updateArrows();
  }

  /*
   * Update available arrows for planet navigation
   */
  function updateArrows(){
    leftArrowContainer.classList.toggle('hidden', currentPlanet === 0);
    rightArrowContainer.classList.toggle('hidden', currentPlanet === planets.length - 1);
  }

  leftArrowContainer.addEventListener('click', () => {
    if(currentPlanet > 0){
      currentPlanet--;
      updatePlanetView();
      saveGame();
    }
  });
  rightArrowContainer.addEventListener('click', () => {
    if(currentPlanet < planets.length -1){
      currentPlanet++;
      updatePlanetView();
      saveGame();
    }
  });

  resetGameBtn.addEventListener('click', () => {
    if(confirm('Are you sure you want to reset the game? This will erase all progress.')){
      localStorage.removeItem('planet_clicker_save');
      location.reload();
    }
  });

  settingsBtn.addEventListener('click', () => {
    const dropdown = document.getElementById('settingsDropdown');
    if(dropdown.style.display === 'block'){
      dropdown.style.display = 'none';
      settingsBtn.setAttribute('aria-expanded', 'false');
    }
    else{
      dropdown.style.display = 'block';
      settingsBtn.setAttribute('aria-expanded', 'true');
    }
  });

  window.addEventListener('click', (e) => {
    const dropdown = document.getElementById('settingsDropdown');
    if(!settingsBtn.contains(e.target) && !dropdown.contains(e.target)){
      dropdown.style.display = 'none';
      settingsBtn.setAttribute('aria-expanded', 'false');
    }
  });

  homeBtn.addEventListener('click', (e) => {
    e.preventDefault();
    window.location.href = homeBtn.href;
  });

  setInterval(() => {
    dollars += dps;
    updateDisplay();
    saveGame();
  }, 1000);

  loadGame();
  updatePlanetView();
</script>
</body>
</html>
